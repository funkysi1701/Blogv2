@page "/"
@using System.Threading

@inject BlogService BlogService

    <Tag></Tag>

@if (blogs == null || blogs.Count == 0)
{
    <p><em>Loading...</em></p>
}
else
{
    <div style="column-count: 2;">
        @foreach (var post in blogs)
        {
            <div>
                <h4><a href="/posts/@post.Slug">@post.Title</a></h4>
                <p>
                    <small>@post.Published_At.Value.ToString("dd MMMM yyyy", CultureInfo.CurrentCulture)</small>
                    &nbsp;@post.Description
                </p>
            </div>
        }
    </div>
}

@code {
    private List<BlogPosts> blogs = new();

    protected override void OnInitialized()
    {
        var timer = new Timer(new TimerCallback(_ =>
        {
            InvokeAsync(async () =>
            {
                blogs = await BlogService.GetBlogsAsync();
                blogs = blogs.Where(x => x.Published).ToList();
                StateHasChanged();
            });
        }), null, 1000, 5000);
    }
}
